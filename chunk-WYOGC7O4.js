import{b as u}from"./chunk-WWSV3HJO.js";import{U as n,Y as c,k as l,o}from"./chunk-EI7UMY6L.js";var m=class a{constructor(e){this.http=e;this.loadCurrentUser()}USERS_KEY="registered_users";currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();loadCurrentUser(){let e=localStorage.getItem("currentUserEmail");if(e){let t=this.loadUsersFromStorage().find(s=>s.email===e);t&&this.currentUserSubject.next(t.profile)}}register(e){let r=this.loadUsersFromStorage();if(r.find(i=>i.email===e.email))return o({success:!1,message:"Email already registered"});let s={email:e.email,password:e.password,profile:e};return r.push(s),this.saveUsersToStorage(r),o({success:!0,message:"Registration successful"})}login(e,r){let s=this.loadUsersFromStorage().find(i=>i.email===e&&i.password===r);return s?(localStorage.setItem("currentUserEmail",e),localStorage.setItem("userProfile",JSON.stringify(s.profile)),this.currentUserSubject.next(s.profile),o({success:!0,message:"Login successful",user:s.profile})):o({success:!1,message:"Invalid email or password"})}logout(){localStorage.removeItem("currentUserEmail"),localStorage.removeItem("userProfile"),this.currentUserSubject.next(null)}updateUserProfile(e){let r=this.loadUsersFromStorage(),t=localStorage.getItem("currentUserEmail");if(!t)return o({success:!1,message:"No user logged in"});let s=r.findIndex(i=>i.email===t);return s!==-1?(r[s].profile=e,e.email!==t&&(r[s].email=e.email,localStorage.setItem("currentUserEmail",e.email)),this.saveUsersToStorage(r),localStorage.setItem("userProfile",JSON.stringify(e)),this.currentUserSubject.next(e),o({success:!0,message:"Profile updated successfully"})):o({success:!1,message:"User not found"})}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){return!!localStorage.getItem("currentUserEmail")}loadUsersFromStorage(){if(typeof localStorage<"u"){let e=localStorage.getItem(this.USERS_KEY);if(e)try{return JSON.parse(e)}catch(r){return console.error("Error parsing users:",r),[]}}return[]}saveUsersToStorage(e){typeof localStorage<"u"&&localStorage.setItem(this.USERS_KEY,JSON.stringify(e))}static \u0275fac=function(r){return new(r||a)(c(u))};static \u0275prov=n({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
