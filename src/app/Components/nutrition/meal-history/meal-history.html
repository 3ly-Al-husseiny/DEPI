<div class="meal-history-container">
  <div class="history-header">
    <h2>ğŸ“œ Meal History</h2>
    @if (meals.length > 0) {
    <button class="clear-btn" (click)="clearAllMeals()">
      ğŸ—‘ï¸ Clear All
    </button>
    }
  </div>

  @if (meals.length === 0) {
  <div class="no-meals-message">
    <div class="message-icon">ğŸ½ï¸</div>
    <h3>No Meals Logged</h3>
    <p>Your meal history will appear here after you analyze and save meals.</p>
  </div>
  } @else {
  <div class="meals-list">
    @for (meal of meals; track meal.id) {
    <div class="meal-card">
      <div class="meal-header" (click)="toggleDetails(meal.id)">
        <div class="meal-info">
          <div class="meal-date-time">
            <span class="date">ğŸ“… {{ formatDate(meal.date) }}</span>
            <span class="time">ğŸ• {{ formatTime(meal.date) }}</span>
          </div>
          <h4 class="meal-description">{{ meal.description }}</h4>
          <div class="meal-summary">
            <span class="calories">ğŸ”¥ {{ meal.analysis.calories }} kcal</span>
            <span class="elements-count">
              ğŸ“Š {{ meal.analysis.elements.length }} nutrients
            </span>
          </div>
        </div>
        <div class="expand-icon">
          {{ expandedMealId === meal.id ? 'â–¼' : 'â–¶' }}
        </div>
      </div>

      @if (expandedMealId === meal.id) {
      <div class="meal-details">
        @if (meal.analysis.servingSize) {
        <div class="serving-info">
          <strong>Serving:</strong> {{ meal.analysis.servingSize }}
        </div>
        }

        <div class="elements-breakdown">
          <h5>Nutritional Elements:</h5>
          <div class="elements-grid-small">
            @for (element of meal.analysis.elements; track element.name) {
            <div class="element-item">
              <span class="element-name">{{ element.name }}</span>
              <span class="element-value">
                {{ element.amount }} {{ element.unit }}
                @if (element.dailyValue) {
                  <span class="dv">({{ element.dailyValue }}% DV)</span>
                }
              </span>
            </div>
            }
          </div>
        </div>

        <div class="meal-actions">
          <button class="delete-btn" (click)="deleteMeal(meal.id); $event.stopPropagation()">
            ğŸ—‘ï¸ Delete
          </button>
        </div>
      </div>
      }
    </div>
    }
  </div>
  }
</div>