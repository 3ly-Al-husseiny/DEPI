<!-- 
  =============================================
  LIBRARY PAGE TEMPLATE
  =============================================
  Contains the main layout for the resource library, including:
  - Responsive Sidebar (Desktop/Tablet/Mobile)
  - Search, Filter, and Sort controls
  - Grid and List views for resources
  - Pagination and Empty States
-->

<div class="library-shell">
    <div class="library-layout" [class.sidebar-collapsed]="store.isSidebarCollapsed()"
        [class.overlay-active]="store.isOverlayActive()">

        <!-- =============================================
         1. SIDEBAR NAVIGATION
         ============================================= -->

        <!-- Desktop/Standard Sidebar -->
        <app-sidebar></app-sidebar>

        <!-- Tablet Overlay Sidebar (Visible only on medium screens) -->
        <app-sidebar class="sidebar-tablet-overlay" [isOverlay]="true"></app-sidebar>

        <!-- Mobile Backdrop (Click to close overlays) -->
        <div class="mobile-backdrop" (click)="store.closeOverlays()"></div>


        <!-- =============================================
         2. MAIN CONTENT AREA
         ============================================= -->
        <main class="main-content">

            <!-- Mobile FAB Menu (Draggable) -->
            <button class="btn-fab-menu" (distinctClick)="store.toggleMobileMenu()" appDraggable aria-label="Open Menu">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
                    <path
                        d="M261 22a187 187 0 0 1 9 9l8 5 1-1 7-6 3-2c25-22 53-29 86-27a92 92 0 0 1 59 33 115 115 0 0 1 25 78v5h38c5 0 7 0 11 2 3 3 3 5 3 9a10 10 0 0 1-3 7c-6 3-11 3-18 3h-34l-1 2c-7 28-23 49-45 67l-15 14-14 15-15 14-17 16-12 12-15 15-15 14a268 268 0 0 1-17 17l-4 3-8 4c-6-1-9-4-13-8l-5-5-4-4-10-9-16-16a261 261 0 0 0-16-15l-7-7-2-2c-3-3-4-5-4-10l3-7a13 13 0 0 1 10-3l10 8 3 3a588 588 0 0 1 37 35 146 146 0 0 1 9 9l4 4 9-7a274 274 0 0 0 17-16l14-14 15-15 17-16 13-12 14-14 15-15 17-17c13-10 20-25 26-40-17-2-17-2-33 3a59 59 0 0 0-10 15l-6 9-2 3c-5 6-5 6-9 7-5 0-6-1-10-3l-4-5-2-3-2-3-8-12-1 2-11 22-1 2-2 3c-2 4-4 6-7 8h-4l-3 1-7-5-4-7-1-2-4-7-17-33-8-14a254 254 0 0 0-14 25l-13 24-2 3c-6 13-6 13-11 15l-4 1h-3c-5-2-7-7-10-11a308 308 0 0 1-7-15l-5-12-11 13c-7 12-7 12-12 13-5 0-6-1-10-3a87 87 0 0 1-7-8l-2-3-7-11c-4-7-4-7-9-11-10-2-19-1-29 0 6 16 14 28 26 40l1 1 5 5c3 3 4 5 4 10l-3 7a13 13 0 0 1-10 3l-10-8-4-3a107 107 0 0 1-31-52v-4H62c-6 0-10 0-15-3-3-4-3-6-2-11 1-3 2-5 5-7h46v-12c0-30 13-58 33-79 36-35 94-33 132-3M138 47a94 94 0 0 0-21 60v9h25c17 0 17 0 22 3l5 7 4 5 10 14 8-10 2-3 4-6 2-3 2-3c2-2 3-3 6-3h5c3 0 5 2 7 5a95 95 0 0 1 5 9l10 21a63 63 0 0 0 7-11l1-2 2-4 6-11 11-20 1-3c8-14 8-14 11-16h4l3-1c3 1 5 3 7 6a203 203 0 0 1 7 12l2 5 3 5 9 17 12 22h2l12-23 1-2 3-8c4-1 8-2 13-1l7 8 2 3 4 6 7 10c3-1 5-3 7-6l2-2 1-3 14-16h13l30-1c3-26-6-50-22-71a70 70 0 0 0-35-22 85 85 0 0 0-82 23c-7 7-13 13-23 13a36 36 0 0 1-18-11 93 93 0 0 0-68-27 72 72 0 0 0-52 26m39 298h4c19 0 37 5 56 10l15 5 3 1c14 4 26 8 34 21l3 8c5-1 9-3 14-6l2-1 12-6 39-20c31-15 31-15 47-11a40 40 0 0 1 23 20 41 41 0 0 1 0 30c-6 12-16 19-27 26l-15 11a439 439 0 0 1-35 25 1426 1426 0 0 1-31 22l-11 8-2 2a98 98 0 0 1-56 23h-3c-24 0-50-12-74-19l-24-7a211 211 0 0 0-45-9l-3-1h-7v2c-2 9-6 14-14 20-6 3-13 3-21 3h-3l-23 1h-3a34 34 0 0 1-25-10 38 38 0 0 1-7-24v-86c0-9 3-17 10-23a37 37 0 0 1 24-7h33c8 0 15 2 21 8a17 17 0 0 1 5 9 68 68 0 0 0 30-12l21-9h2c10-4 20-4 31-4m-49 35a80 80 0 0 1-32 11v65l24 2c21 4 42 10 63 16l29 9c20 6 20 6 40 9h2c17-1 32-12 45-22l15-11 18-13 20-14 17-12a368 368 0 0 1 16-12c16-10 16-10 26-25 0-5-1-9-4-12a17 17 0 0 0-11-5c-10 0-19 6-27 10l-30 16-2 1a1136 1136 0 0 1-28 13l-14 7-3 1-7 10a33 33 0 0 1-21 13c-15 2-28-2-42-7l-24-7-2-1-5-1-3-1c-3-1-4-3-6-6 0-8 0-8 2-11 3-3 7-2 11-2l13 3 3 2 33 10h3c7 2 12 2 18-1 5-4 7-8 7-14 0-4-1-8-4-12a43 43 0 0 0-15-7l-3-1-8-2-3-1c-39-12-75-19-111 2m-105-3c-2 3-1 7-1 11v33l-1 38v11c0 5 0 5 3 10l7 2h37c3-1 5-3 7-6l1-9v-19l-1-31 1-29v-2l-2-9c-3-3-6-3-9-3H35c-5 0-8 0-12 3">
                    </path>
                    <path d="M184 214c3 1 3 1 5 4v12a17 17 0 0 1-9 5c-4-1-6-1-9-4-2-4-3-6-2-10 3-7 8-8 15-7"></path>
                </svg>
            </button>

            <div class="content px-3 px-md-4 py-4">

                <!-- =============================================
             3. PAGE HEADER
             ============================================= -->
                <div class="page-header">

                    <!-- View: Recommended -->
                    <div *ngIf="store.activeFilter() === 'recommended'">
                        <div *ngIf="store.favoriteIds().length > 0">
                            <h1 class="display-6 fw-bold mb-1">Recommended For You</h1>
                            <p class="mb-3 text-muted-app">
                                Curated picks based on your interests in
                                <span class="text-white">{{ store.favoriteIds().length }}</span> favorite resources.
                            </p>
                        </div>
                        <div *ngIf="store.favoriteIds().length === 0">
                            <h1 class="display-6 fw-bold mb-1">Discover Something New</h1>
                            <p class="mb-3 text-muted-app">
                                Start <strong>favoriting</strong><span class="text-white"> ‚ù§ </span>items to get
                                personalized recommendations here!
                            </p>
                        </div>
                    </div>

                    <!-- View: All Resources -->
                    <div *ngIf="store.activeFilter() === 'all'">
                        <h1 class="display-6 fw-bold mb-1">All Resources</h1>
                        <p class="mb-3 text-muted-app">A curated collection of articles, videos, and tools to help you
                            on your wellness journey.</p>
                    </div>

                    <!-- View: Favorites -->
                    <div *ngIf="store.activeFilter() === 'favorites'">
                        <h1 class="display-6 fw-bold mb-1">Your Favorites</h1>
                        <p class="mb-3 text-muted-app">Your personal collection of saved wellness resources.</p>
                    </div>
                </div>


                <!-- =============================================
             4. ACTION BAR (Search, Sort, Filters)
             ============================================= -->
                <div class="actionbar glass card border-0 mb-3">

                    <div class="action-bar-top">
                        <!-- Search Input -->
                        <div class="search input-icon">
                            <span class="icon" aria-hidden="true">üîé</span>
                            <input type="text" class="form-control bg-transparent text-white"
                                placeholder="Search by title, tag, or keyword..." [ngModel]="store.search()"
                                (ngModelChange)="store.setSearch($event)">
                            <button *ngIf="store.search()" (click)="store.setSearch('')" class="btn-clear-search"
                                aria-label="Clear search">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M18 6L6 18M6 6l12 12" />
                                </svg>
                            </button>
                        </div>

                        <!-- Controls Cluster (Sort, View Toggle, Clear Filters) -->
                        <div class="controls-cluster">

                            <!-- Sort By -->
                            <div class="sort-by-control" [class.hidden]="store.activeFilter() === 'recommended'">
                                <label class="small text-muted-app mb-0 fw-semibold">Sort by</label>
                                <div class="btn-group view-switch" role="group">
                                    <button type="button" class="btn btn-outline-light btn-sm"
                                        [class.active]="store.sortBy()==='newest'"
                                        (click)="store.setSort('newest')">Newest</button>
                                    <button type="button" class="btn btn-outline-light btn-sm"
                                        [class.active]="store.sortBy()==='title'"
                                        (click)="store.setSort('title')">Title</button>
                                </div>
                            </div>

                            <!-- View Toggle (Grid/List) - Desktop Only -->
                            <div class="btn-group view-switch view-toggle-desktop" role="group"
                                aria-label="view switch">
                                <button type="button" class="btn btn-outline-light btn-sm"
                                    [class.active]="store.viewMode()==='list'" (click)="store.setViewMode('list')"
                                    title="List view">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.7"
                                            stroke-linecap="round"></path>
                                    </svg>
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm"
                                    [class.active]="store.viewMode()==='grid'" (click)="store.setViewMode('grid')"
                                    title="Grid view">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <path d="M10 3H3v7h7V3Zm11 0h-7v7h7V3ZM10 14H3v7h7v-7Zm11 0h-7v7h7v-7Z"
                                            stroke="currentColor" stroke-width="1.4"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- Clear Filters Button -->
                            <button *ngIf="store.areFiltersActive()" (click)="store.clearAllFilters()"
                                class="btn-clear-filters" aria-label="Clear filters">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 240 240"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="20">
                                    <path
                                        d="M210 210 30 30v40s0 0 0 0 0 0 0 0l70 70s0 0 0 0 0 0 0 0v70l40-40v-30M90 30h110l10 10v30s0 0 0 0 0 0 0 0l-40 40" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Filter Rows (Category & Format) -->
                    <div class="action-bar-filters">
                        <div class="filter-group">
                            <label class="filter-label">Category</label>
                            <div class="filter-row">
                                <button type="button" class="btn btn-filter btn-sm"
                                    [class.active]="store.selectedCategories().length === 0"
                                    (click)="store.clearCategories()">All</button>
                                <button type="button" class="btn btn-filter btn-sm" *ngFor="let cat of categories"
                                    [class.active]="store.selectedCategories().includes(cat)"
                                    (click)="store.toggleCategory(cat)">{{ cat }}</button>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Format</label>
                            <div class="filter-row">
                                <button type="button" class="btn btn-filter btn-sm"
                                    [class.active]="store.selectedFormats().length === 0"
                                    (click)="store.clearFormats()">All</button>
                                <button type="button" class="btn btn-filter btn-sm" *ngFor="let fmt of formats"
                                    [class.active]="store.selectedFormats().includes(fmt)"
                                    (click)="store.toggleFormat(fmt)">{{ fmt }}</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- =============================================
             5. UI STATES (Loading & Error)
             ============================================= -->

                <!-- Loading Spinner -->
                <div *ngIf="store.loading()" class="loading-container">
                    <div class="loader"></div>
                </div>

                <!-- Error Panel -->
                <div *ngIf="store.error() as errorMessage" class="error-panel">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M12 9v2m0 4v.01"></path>
                        <path
                            d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75">
                        </path>
                    </svg>
                    <h5 class="h5">An Error Occurred</h5>
                    <p class="mb-0 small">{{ errorMessage }}</p>
                </div>


                <!-- =============================================
             6. RESULTS DISPLAY
             ============================================= -->
                <div *ngIf="!store.loading() && !store.error()">

                    <div *ngIf="store.paginatedItems().length > 0; else noResults">

                        <!-- View Container (Dynamic Class based on View Mode) -->
                        <div class="results-wrapper" [ngClass]="'view-' + store.viewMode()">

                            <!-- A. GRID VIEW TEMPLATE -->
                            <div class="view-container-grid row g-3">
                                <div class="col-sm-6 col-lg-4 col-xxl-3" *ngFor="let item of store.paginatedItems()">
                                    <a [routerLink]="['/library', item.id]"
                                        class="resource card card-cover border-0 h-100 text-reset">

                                        <!-- Favorite Button -->
                                        <button type="button" class="btn-favorite" title="Toggle favorite"
                                            [class.active]="isFavorite(item.id)"
                                            (click)="store.toggleFavorite(item.id); $event.stopPropagation(); $event.preventDefault()">
                                            <svg fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd"
                                                    d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </button>

                                        <!-- Media Thumbnail / Placeholder -->
                                        <div class="resource-media">
                                            <img *ngIf="item.thumbnail" class="resource-media-img"
                                                [src]="item.thumbnail" referrerpolicy="no-referrer"
                                                (error)="item.thumbnail = undefined" alt="">

                                            <div *ngIf="!item.thumbnail" class="resource-media-placeholder">
                                                <ng-container [ngSwitch]="item.format">
                                                    <svg *ngSwitchCase="'Video'" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path
                                                            d="M22.54 6.42a2.24 2.24 0 0 0-1.76-1.9C18.28 4 12 4 12 4s-6.28 0-8.78.52A2.24 2.24 0 0 0 1.46 6.42a24.2 24.2 0 0 0 0 11.16 2.24 2.24 0 0 0 1.76 1.9c2.5.52 8.78.52 8.78.52s6.28 0 8.78-.52a2.24 2.24 0 0 0 1.76-1.9 24.2 24.2 0 0 0 0-11.16z">
                                                        </path>
                                                        <polygon points="9.5 15.5 15.5 12 9.5 8.5 9.5 15.5"></polygon>
                                                    </svg>
                                                    <svg *ngSwitchCase="'Podcast'" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z">
                                                        </path>
                                                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                                        <line x1="12" y1="19" x2="12" y2="23"></line>
                                                        <line x1="8" y1="23" x2="16" y2="23"></line>
                                                    </svg>
                                                    <svg *ngSwitchCase="'Guide'" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                                    </svg>
                                                    <svg *ngSwitchCase="'Website'" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <line x1="2" y1="12" x2="22" y2="12"></line>
                                                        <path
                                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                                        </path>
                                                    </svg>
                                                    <svg *ngSwitchDefault viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path
                                                            d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                                                        </path>
                                                    </svg>
                                                </ng-container>
                                            </div>
                                        </div>

                                        <!-- Content Body -->
                                        <div class="resource-body d-flex flex-column">
                                            <div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <!-- Category Chip -->
                                                    <a [routerLink]="['/library']"
                                                        [queryParams]="{ categories: item.category }"
                                                        (click)="store.setCategories([item.category]); $event.stopPropagation(); $event.preventDefault()"
                                                        class="badge badge-soft badge-interactive">{{ item.category
                                                        }}</a>

                                                    <!-- Format Chip -->
                                                    <a [routerLink]="['/library']"
                                                        [queryParams]="{ formats: item.format }"
                                                        (click)="store.setFormats([item.format]); $event.stopPropagation(); $event.preventDefault()"
                                                        class="badge badge-chip badge-interactive" [ngClass]="{ 
                                'chip-video': item.format==='Video', 
                                'chip-article': item.format==='Article', 
                                'chip-podcast': item.format==='Podcast', 
                                'chip-guide': item.format==='Guide', 
                                'chip-website': item.format==='Website' 
                              }">
                                                        {{ item.format }}
                                                    </a>
                                                </div>
                                                <div class="title fw-semibold">{{ item.title }}</div>
                                                <div class="desc text-muted-app small">{{ item.description }}</div>
                                            </div>

                                            <!-- Footer Meta -->
                                            <div class="mt-auto">
                                                <div class="tags-container mt-2" *ngIf="item.tags.length">
                                                    <a *ngFor="let tag of item.tags" [routerLink]="['/library']"
                                                        [queryParams]="{ search: tag }"
                                                        (click)="store.setSearch(tag); $event.stopPropagation(); $event.preventDefault()"
                                                        class="tag-link"><span class="badge-tag">#{{ tag }}</span></a>
                                                </div>
                                                <div class="meta small text-muted-app mt-2">
                                                    <span *ngIf="item.duration">‚è± {{ item.duration }}</span>
                                                    <span *ngIf="item.level"> ‚Ä¢ {{ item.level }}</span>
                                                    <span> ‚Ä¢ {{ item.published | date:'MMM d, y' }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <!-- B. LIST VIEW TEMPLATE -->
                            <div class="view-container-list listview">
                                <a [routerLink]="['/library', item.id]" class="lv-item glass text-reset"
                                    *ngFor="let item of store.paginatedItems()">

                                    <!-- Left: Media -->
                                    <div class="lv-media">
                                        <img *ngIf="item.thumbnail" class="resource-media-img" [src]="item.thumbnail"
                                            referrerpolicy="no-referrer" (error)="item.thumbnail = undefined" alt="">
                                        <div *ngIf="!item.thumbnail" class="resource-media-placeholder">
                                            <ng-container [ngSwitch]="item.format">
                                                <svg *ngSwitchCase="'Video'" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path
                                                        d="M22.54 6.42a2.24 2.24 0 0 0-1.76-1.9C18.28 4 12 4 12 4s-6.28 0-8.78.52A2.24 2.24 0 0 0 1.46 6.42a24.2 24.2 0 0 0 0 11.16 2.24 2.24 0 0 0 1.76 1.9c2.5.52 8.78.52 8.78.52s6.28 0 8.78-.52a2.24 2.24 0 0 0 1.76-1.9 24.2 24.2 0 0 0 0-11.16z">
                                                    </path>
                                                    <polygon points="9.5 15.5 15.5 12 9.5 8.5 9.5 15.5"></polygon>
                                                </svg>
                                                <svg *ngSwitchCase="'Podcast'" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z">
                                                    </path>
                                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                                    <line x1="12" y1="19" x2="12" y2="23"></line>
                                                    <line x1="8" y1="23" x2="16" y2="23"></line>
                                                </svg>
                                                <svg *ngSwitchCase="'Guide'" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                                </svg>
                                                <svg *ngSwitchCase="'Website'" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                                    <path
                                                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                                    </path>
                                                </svg>
                                                <svg *ngSwitchDefault viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path
                                                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                                                    </path>
                                                </svg>
                                            </ng-container>
                                        </div>
                                    </div>

                                    <!-- Right: Content -->
                                    <div class="lv-body">
                                        <!-- Favorite Button -->
                                        <button type="button" class="btn-favorite" title="Toggle favorite"
                                            [class.active]="isFavorite(item.id)"
                                            (click)="store.toggleFavorite(item.id); $event.stopPropagation(); $event.preventDefault()">
                                            <svg fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd"
                                                    d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </button>

                                        <div>
                                            <div class="mb-1">
                                                <a [routerLink]="['/library']"
                                                    [queryParams]="{ categories: item.category }"
                                                    (click)="store.setCategories([item.category]); $event.stopPropagation(); $event.preventDefault()"
                                                    class="badge badge-soft badge-interactive">{{ item.category }}</a>
                                            </div>
                                            <div class="title fw-semibold">{{ item.title }}</div>
                                            <div class="desc text-muted-app small mb-1">{{ item.description }}</div>
                                            <div class="tags-container" *ngIf="item.tags.length">
                                                <a *ngFor="let tag of item.tags" [routerLink]="['/library']"
                                                    [queryParams]="{ search: tag }"
                                                    (click)="store.setSearch(tag); $event.stopPropagation(); $event.preventDefault()"
                                                    class="tag-link"><span class="badge-tag">#{{ tag }}</span></a>
                                            </div>
                                        </div>

                                        <div class="meta small text-muted-app">
                                            <a [routerLink]="['/library']" [queryParams]="{ formats: item.format }"
                                                (click)="store.setFormats([item.format]); $event.stopPropagation(); $event.preventDefault()"
                                                class="badge badge-chip badge-interactive me-1" [ngClass]="{ 
                            'chip-video': item.format==='Video', 
                            'chip-article': item.format==='Article', 
                            'chip-podcast': item.format==='Podcast', 
                            'chip-guide': item.format==='Guide', 
                            'chip-website': item.format==='Website' 
                         }">{{ item.format }}</a>
                                            <span *ngIf="item.duration"> ‚Ä¢ ‚è± {{ item.duration }}</span>
                                            <span *ngIf="item.level"> ‚Ä¢ {{ item.level }}</span>
                                            <span> ‚Ä¢ {{ item.published | date:'MMM d, y' }}</span>
                                        </div>
                                    </div>
                                </a>
                            </div>

                        </div>
                    </div>

                    <!-- C. NO RESULTS STATES -->
                    <ng-template #noResults>
                        <!-- Empty Favorites -->
                        <div *ngIf="store.activeFilter() === 'favorites'">
                            <div class="no-results-panel">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
                                    <path d="M12 21h-5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v4"></path>
                                    <circle cx="16.5" cy="17.5" r="2.5"></circle>
                                    <line x1="18.5" y1="19.5" x2="20.5" y2="21.5"></line>
                                </svg>
                                <h5 class="h5">No Favorites Yet üò™</h5>
                                <p class="mb-0 small">Click the heart icon on any resource to add it here!</p>
                            </div>
                        </div>

                        <!-- Empty Search/Filters -->
                        <div *ngIf="store.activeFilter() !== 'favorites'">
                            <div class="no-results-panel">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
                                    <path d="M12 21h-5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v4"></path>
                                    <circle cx="16.5" cy="17.5" r="2.5"></circle>
                                    <line x1="18.5" y1="19.5" x2="20.5" y2="21.5"></line>
                                </svg>
                                <h5 class="h5">No Resources Found</h5>
                                <p class="mb-0 small">Try adjusting your search terms or clearing some filters.</p>
                            </div>
                        </div>
                    </ng-template>


                    <!-- =============================================
               7. PAGINATION & FOOTER
               ============================================= -->

                    <!-- Pagination Controls -->
                    <nav class="mt-4 d-flex justify-content-center" *ngIf="store.totalPages() > 1">
                        <ul class="pagination pagination-sm glass mb-0">
                            <li class="page-item" [class.disabled]="store.currentPage() === 1">
                                <a class="page-link" href="javascript:void(0)"
                                    (click)="store.setCurrentPage(store.currentPage() - 1)">¬´</a>
                            </li>
                            <li class="page-item" *ngFor="let page of pageNumbers()"
                                [class.active]="page === store.currentPage()">
                                <a class="page-link" href="javascript:void(0)" (click)="store.setCurrentPage(page)">{{
                                    page }}</a>
                            </li>
                            <li class="page-item" [class.disabled]="store.currentPage() === store.totalPages()">
                                <a class="page-link" href="javascript:void(0)"
                                    (click)="store.setCurrentPage(store.currentPage() + 1)">¬ª</a>
                            </li>
                        </ul>
                    </nav>

                    <!-- Recommended View Footer (Call to Action) -->
                    <div *ngIf="store.activeFilter() === 'recommended'" class="text-center mt-5 pb-2">
                        <p class="text-muted-app small mb-2" *ngIf="store.favoriteIds().length === 0">Want to see
                            everything we have?</p>
                        <p class="text-muted-app small mb-2" *ngIf="store.favoriteIds().length > 0">Didn't find the
                            perfect match?</p>
                        <button class="btn btn-cta" (click)="store.setActiveFilter('all')">Browse Full Library</button>
                    </div>

                </div> <!-- End of Results Block -->
            </div> <!-- End of Content Padding -->
        </main>
    </div>
</div>