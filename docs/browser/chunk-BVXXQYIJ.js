import{f as T}from"./chunk-GJNWURYR.js";import{a as P,b as k}from"./chunk-WWSV3HJO.js";import{E as O,H as w,O as R,U as p,Y as v,Z as j,ec as M,fc as h,ga as N,gc as f,ia as x,l as D,ma as i,u as S}from"./chunk-EI7UMY6L.js";var y=class a{constructor(e){this.http=e}getResources(e){let t=new P;return e.search&&(t=t.append("search",e.search)),e.categories?.length&&(t=t.append("categories",e.categories.join(","))),e.formats?.length&&(t=t.append("formats",e.formats.join(","))),e.sort&&(t=t.append("sort",e.sort)),e.page&&(t=t.append("page",e.page)),e.pageSize&&(t=t.append("pageSize",e.pageSize)),this.http.get("data/library/resources.json").pipe(S(r=>{let{search:c,categories:n,formats:o,sort:b,page:s=1,pageSize:d=9,activeFilter:g,favoriteIds:I=[]}=e,l=r;if(g==="recommended"?l=this.generateRecommendations(r,I):g==="favorites"&&(l=l.filter(u=>I.includes(u.id))),c){let u=c.toLowerCase();l=l.filter(m=>m.title.toLowerCase().includes(u)||m.tags.some(z=>z.toLowerCase().includes(u)))}n&&n.length>0&&(l=l.filter(u=>n.includes(u.category))),o&&o.length>0&&(l=l.filter(u=>o.includes(u.format))),g!=="recommended"&&(b==="title"?l.sort((u,m)=>u.title.localeCompare(m.title)):l.sort((u,m)=>new Date(m.published).getTime()-new Date(u.published).getTime()));let U=l.length,C=(s-1)*d;return{items:l.slice(C,C+d),totalItems:U}}))}getResourceById(e){return this.http.get("data/library/resources.json").pipe(S(t=>t.find(r=>r.id===e)))}generateRecommendations(e,t){if(!t||t.length===0)return[...e].sort(()=>.5-Math.random());let r=e.filter(s=>t.includes(s.id)),c={},n={},o={};return r.forEach(s=>{c[s.category]=(c[s.category]||0)+1,n[s.format]=(n[s.format]||0)+1,s.tags.forEach(d=>o[d]=(o[d]||0)+1)}),e.filter(s=>!t.includes(s.id)).map(s=>{let d=0;return c[s.category]&&(d+=10*c[s.category]),s.tags.forEach(g=>{o[g]&&(d+=5*o[g])}),n[s.format]&&(d+=3*n[s.format]),d+=s.id*.1,{item:s,score:d}}).filter(s=>s.score>0).sort((s,d)=>d.score-s.score).map(s=>s.item)}static \u0275fac=function(t){return new(t||a)(v(k))};static \u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})};function A(a,e){let t=e?.injector??j(N),r=new D(1),c=f(()=>{let n;try{n=a()}catch(o){M(()=>r.error(o));return}M(()=>r.next(n))},{injector:t,manualCleanup:!0});return t.get(x).onDestroy(()=>{c.destroy(),r.complete()}),r.asObservable()}var F=class a{FAVORITES_STORAGE_KEY="favorites";getFavorites(){try{let e=localStorage.getItem(this.FAVORITES_STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.warn("Error reading favorites from localStorage, resetting to empty.",e),[]}}addFavorite(e){let t=this.getFavorites();if(!t.includes(e)){let r=[...t,e];this.saveFavorites(r)}}removeFavorite(e){let r=this.getFavorites().filter(c=>c!==e);this.saveFavorites(r)}saveFavorites(e){try{localStorage.setItem(this.FAVORITES_STORAGE_KEY,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to localStorage",t)}}static \u0275fac=function(t){return new(t||a)};static \u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})};var q=class a{constructor(e,t,r){this._ResourceApi=e;this._Favorites=t;this._router=r;f(()=>{let o={search:this.search()||null,sort:this.sortBy()!=="newest"?this.sortBy():null,categories:this.selectedCategories().length>0?this.selectedCategories().join(","):null,formats:this.selectedFormats().length>0?this.selectedFormats().join(","):null,view:this.activeFilter()!=="recommended"?this.activeFilter():null};this._router.navigate(["/library"],{queryParams:o,queryParamsHandling:"merge",replaceUrl:!0})});let c=h(()=>({search:this.search(),categories:this.selectedCategories(),formats:this.selectedFormats(),sort:this.sortBy(),page:this.currentPage(),pageSize:this.pageSize(),activeFilter:this.activeFilter(),favoriteIds:this.activeFilter()==="favorites"?this.favoriteIds():this.activeFilter()==="recommended"?this.recommendationSnapshot():void 0}));A(c).pipe(O(300),w((o,b)=>JSON.stringify(o)===JSON.stringify(b)),R(o=>(this.loading.set(!0),this._ResourceApi.getResources(o)))).subscribe({next:o=>{this.paginatedItems.set(o.items),this.totalItems.set(o.totalItems),this.loading.set(!1)},error:o=>{console.error("Failed to load resources:",o),this.error.set("Could not load wellness resources. Please try again later."),this.loading.set(!1)}});let n=localStorage.getItem("isSidebarCollapsed");n&&this.isSidebarCollapsed.set(JSON.parse(n)),f(()=>{localStorage.setItem("isSidebarCollapsed",JSON.stringify(this.isSidebarCollapsed()))})}paginatedItems=i([]);totalItems=i(0);loading=i(!0);error=i(null);favoriteIds=i([]);search=i("");selectedCategories=i([]);selectedFormats=i([]);sortBy=i("newest");currentPage=i(1);pageSize=i(9);activeFilter=i("recommended");recommendationSnapshot=i([]);viewMode=i("grid");isSidebarCollapsed=i(!1);isMobileMenuOpen=i(!1);isTabletOverlayOpen=i(!1);totalPages=h(()=>Math.ceil(this.totalItems()/this.pageSize()));areFiltersActive=h(()=>this.selectedCategories().length>0||this.selectedFormats().length>0);isOverlayActive=h(()=>this.isMobileMenuOpen()||this.isTabletOverlayOpen());loadInitialData(){this.loadFavorites(),this.recommendationSnapshot.set(this.favoriteIds())}loadFavorites(){this.favoriteIds.set(this._Favorites.getFavorites())}toggleFavorite(e){this.favoriteIds().includes(e)?this._Favorites.removeFavorite(e):this._Favorites.addFavorite(e),this.loadFavorites()}setSearch(e){this.search.set(e),this.currentPage.set(1)}setSort(e){this.sortBy.set(e),this.currentPage.set(1)}setCurrentPage(e){this.currentPage.set(e)}setActiveFilter(e){e==="recommended"&&this.recommendationSnapshot.set(this.favoriteIds()),this.activeFilter.set(e),this.currentPage.set(1)}toggleCategory(e){this.selectedCategories.update(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),Array.from(r)}),this.currentPage.set(1)}setCategories(e){this.selectedCategories.set(e)}clearCategories(){this.selectedCategories.set([]),this.currentPage.set(1)}toggleFormat(e){this.selectedFormats.update(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),Array.from(r)}),this.currentPage.set(1)}setFormats(e){this.selectedFormats.set(e)}clearFormats(){this.selectedFormats.set([]),this.currentPage.set(1)}resetFilters(){this.search.set(""),this.selectedCategories.set([]),this.selectedFormats.set([]),this.sortBy.set("newest"),this.currentPage.set(1)}clearAllFilters(){this.selectedCategories.set([]),this.selectedFormats.set([]),this.currentPage.set(1)}toggleSidebar(){this.isSidebarCollapsed.set(!this.isSidebarCollapsed())}toggleMobileMenu(){this.isMobileMenuOpen.set(!this.isMobileMenuOpen())}toggleTabletOverlay(){this.isTabletOverlayOpen.set(!this.isTabletOverlayOpen())}closeOverlays(){this.isMobileMenuOpen.set(!1),this.isTabletOverlayOpen.set(!1)}setViewMode(e){this.viewMode.set(e)}static \u0275fac=function(t){return new(t||a)(v(y),v(F),v(T))};static \u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})};export{y as a,q as b};
