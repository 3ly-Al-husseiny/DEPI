import{b as be,d as Ee,i as Me,v as ye}from"./chunk-CZTYIC4U.js";import{Cb as z,Cc as N,Eb as J,Fb as W,Gb as h,Mb as fe,Pa as l,Pb as s,Qb as S,Rb as E,Sb as H,Tb as he,U as q,Ub as _e,Vb as Ce,Za as D,a as ue,b as ge,ca as I,cb as A,da as P,j as pe,jc as xe,nb as x,ob as v,rb as L,sb as F,tb as $,ub as m,vb as c,vc as ve,wb as G,xb as _,yb as f}from"./chunk-EI7UMY6L.js";var Oe=["user","model","function","system"];var X=(function(e){return e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER",e})(X||{});var b=class extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}},T=class extends b{constructor(n,t){super(n),this.response=t}},Z=class extends b{constructor(n,t,i,o){super(n),this.status=t,this.statusText=i,this.errorDetails=o}},w=class extends b{},ee=class extends b{};var Le="https://generativelanguage.googleapis.com",Fe="v1beta",ze="0.24.1",He="genai-js",V=(function(e){return e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents",e})(V||{}),se=class{constructor(n,t,i,o,a){this.model=n,this.task=t,this.apiKey=i,this.stream=o,this.requestOptions=a}toString(){var n,t;let i=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Fe,a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Le}/${i}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}};function Ue(e){let n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${He}/${ze}`),n.join(" ")}async function $e(e){var n;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Ue(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let i=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(o){throw new w(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${o.message}`)}for(let[o,a]of i.entries()){if(o==="x-goog-api-key")throw new w(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new w(`Header name ${o} can only be set using the apiClient field`);t.append(o,a)}}return t}async function Ge(e,n,t,i,o,a){let r=new se(e,n,t,i,a);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},Ke(a)),{method:"POST",headers:await $e(r),body:o})}}async function K(e,n,t,i,o,a={},r=fetch){let{url:d,fetchOptions:p}=await Ge(e,n,t,i,o,a);return Ve(d,p,r)}async function Ve(e,n,t=fetch){let i;try{i=await t(e,n)}catch(o){je(o,e)}return i.ok||await Ye(i,e),i}function je(e,n){let t=e;throw t.name==="AbortError"?(t=new ee(`Request aborted when fetching ${n.toString()}: ${e.message}`),t.stack=e.stack):e instanceof Z||e instanceof w||(t=new b(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function Ye(e,n){let t="",i;try{let o=await e.json();t=o.error.message,o.error.details&&(t+=` ${JSON.stringify(o.error.details)}`,i=o.error.details)}catch{}throw new Z(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,i)}function Ke(e){let n={};if(e?.signal!==void 0||e?.timeout>=0){let t=new AbortController;e?.timeout>=0&&setTimeout(()=>t.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function ce(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Q(e.candidates[0]))throw new T(`${R(e)}`,e);return Be(e)}else if(e.promptFeedback)throw new T(`Text not available. ${R(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Q(e.candidates[0]))throw new T(`${R(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Se(e)[0]}else if(e.promptFeedback)throw new T(`Function call not available. ${R(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Q(e.candidates[0]))throw new T(`${R(e)}`,e);return Se(e)}else if(e.promptFeedback)throw new T(`Function call not available. ${R(e)}`,e)},e}function Be(e){var n,t,i,o;let a=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.text&&a.push(r.text),r.executableCode&&a.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&a.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Se(e){var n,t,i,o;let a=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&a.push(r.functionCall);if(a.length>0)return a}var qe=[X.RECITATION,X.SAFETY,X.LANGUAGE];function Q(e){return!!e.finishReason&&qe.includes(e.finishReason)}function R(e){var n,t,i;let o="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)o+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(o+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((i=e.candidates)===null||i===void 0)&&i[0]){let a=e.candidates[0];Q(a)&&(o+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(o+=`: ${a.finishMessage}`))}return o}function j(e){return this instanceof j?(this.v=e,this):new j(e)}function Je(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(e,n||[]),o,a=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(u){i[u]&&(o[u]=function(g){return new Promise(function(M,U){a.push([u,g,M,U])>1||d(u,g)})})}function d(u,g){try{p(i[u](g))}catch(M){O(a[0][3],M)}}function p(u){u.value instanceof j?Promise.resolve(u.value.v).then(C,y):O(a[0][2],u)}function C(u){d("next",u)}function y(u){d("throw",u)}function O(u,g){u(g),a.shift(),a.length&&d(a[0][0],a[0][1])}}var we=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function We(e){let n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Ze(n),[i,o]=t.tee();return{stream:Qe(i),response:Xe(o)}}async function Xe(e){let n=[],t=e.getReader();for(;;){let{done:i,value:o}=await t.read();if(i)return ce(et(n));n.push(o)}}function Qe(e){return Je(this,arguments,function*(){let t=e.getReader();for(;;){let{value:i,done:o}=yield j(t.read());if(o)break;yield yield j(ce(i))}})}function Ze(e){let n=e.getReader();return new ReadableStream({start(i){let o="";return a();function a(){return n.read().then(({value:r,done:d})=>{if(d){if(o.trim()){i.error(new b("Failed to parse stream"));return}i.close();return}o+=r;let p=o.match(we),C;for(;p;){try{C=JSON.parse(p[1])}catch{i.error(new b(`Error parsing JSON response: "${p[1]}"`));return}i.enqueue(C),o=o.substring(p[0].length),p=o.match(we)}return a()}).catch(r=>{let d=r;throw d.stack=r.stack,d.name==="AbortError"?d=new ee("Request aborted when reading from the stream"):d=new b("Error reading from the stream"),d})}}})}function et(e){let n=e[e.length-1],t={promptFeedback:n?.promptFeedback};for(let i of e){if(i.candidates){let o=0;for(let a of i.candidates)if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:o}),t.candidates[o].citationMetadata=a.citationMetadata,t.candidates[o].groundingMetadata=a.groundingMetadata,t.candidates[o].finishReason=a.finishReason,t.candidates[o].finishMessage=a.finishMessage,t.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[o].content||(t.candidates[o].content={role:a.content.role||"user",parts:[]});let r={};for(let d of a.content.parts)d.text&&(r.text=d.text),d.functionCall&&(r.functionCall=d.functionCall),d.executableCode&&(r.executableCode=d.executableCode),d.codeExecutionResult&&(r.codeExecutionResult=d.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[o].content.parts.push(r)}o++}i.usageMetadata&&(t.usageMetadata=i.usageMetadata)}return t}async function Ne(e,n,t,i){let o=await K(n,V.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),i);return We(o)}async function Te(e,n,t,i){let a=await(await K(n,V.GENERATE_CONTENT,e,!1,JSON.stringify(t),i)).json();return{response:ce(a)}}function Re(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Y(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(let t of e)typeof t=="string"?n.push({text:t}):n.push(t);return tt(n)}function tt(e){let n={role:"user",parts:[]},t={role:"function",parts:[]},i=!1,o=!1;for(let a of e)"functionResponse"in a?(t.parts.push(a),o=!0):(n.parts.push(a),i=!0);if(i&&o)throw new b("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!o)throw new b("No content is provided for sending chat message.");return i?n:t}function nt(e,n){var t;let i={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(t=n?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},o=e.generateContentRequest!=null;if(e.contents){if(o)throw new w("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(o)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{let a=Y(e);i.contents=[a]}return{generateContentRequest:i}}function Ie(e){let n;return e.contents?n=e:n={contents:[Y(e)]},e.systemInstruction&&(n.systemInstruction=Re(e.systemInstruction)),n}function it(e){return typeof e=="string"||Array.isArray(e)?{content:Y(e)}:e}var Pe=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],ot={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function at(e){let n=!1;for(let t of e){let{role:i,parts:o}=t;if(!n&&i!=="user")throw new b(`First content should be with role 'user', got ${i}`);if(!Oe.includes(i))throw new b(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Oe)}`);if(!Array.isArray(o))throw new b("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new b("Each Content should have at least one part");let a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let d of o)for(let p of Pe)p in d&&(a[p]+=1);let r=ot[i];for(let d of Pe)if(!r.includes(d)&&a[d]>0)throw new b(`Content with role '${i}' can't contain '${d}' part`);n=!0}}function De(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;let t=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let i of t.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}var Ae="SILENT_ERROR",le=class{constructor(n,t,i,o={}){this.model=t,this.params=i,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,i?.history&&(at(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var i,o,a,r,d,p;await this._sendPromise;let C=Y(n),y={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(p=this.params)===null||p===void 0?void 0:p.cachedContent,contents:[...this._history,C]},O=Object.assign(Object.assign({},this._requestOptions),t),u;return this._sendPromise=this._sendPromise.then(()=>Te(this._apiKey,this.model,y,O)).then(g=>{var M;if(De(g.response)){this._history.push(C);let U=Object.assign({parts:[],role:"model"},(M=g.response.candidates)===null||M===void 0?void 0:M[0].content);this._history.push(U)}else{let U=R(g.response);U&&console.warn(`sendMessage() was unsuccessful. ${U}. Inspect response object for details.`)}u=g}).catch(g=>{throw this._sendPromise=Promise.resolve(),g}),await this._sendPromise,u}async sendMessageStream(n,t={}){var i,o,a,r,d,p;await this._sendPromise;let C=Y(n),y={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(p=this.params)===null||p===void 0?void 0:p.cachedContent,contents:[...this._history,C]},O=Object.assign(Object.assign({},this._requestOptions),t),u=Ne(this._apiKey,this.model,y,O);return this._sendPromise=this._sendPromise.then(()=>u).catch(g=>{throw new Error(Ae)}).then(g=>g.response).then(g=>{if(De(g)){this._history.push(C);let M=Object.assign({},g.candidates[0].content);M.role||(M.role="model"),this._history.push(M)}else{let M=R(g);M&&console.warn(`sendMessageStream() was unsuccessful. ${M}. Inspect response object for details.`)}}).catch(g=>{g.message!==Ae&&console.error(g)}),u}};async function rt(e,n,t,i){return(await K(n,V.COUNT_TOKENS,e,!1,JSON.stringify(t),i)).json()}async function st(e,n,t,i){return(await K(n,V.EMBED_CONTENT,e,!1,JSON.stringify(t),i)).json()}async function lt(e,n,t,i){let o=t.requests.map(r=>Object.assign(Object.assign({},r),{model:n}));return(await K(n,V.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),i)).json()}var te=class{constructor(n,t,i={}){this.apiKey=n,this._requestOptions=i,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Re(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var i;let o=Ie(n),a=Object.assign(Object.assign({},this._requestOptions),t);return Te(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},o),a)}async generateContentStream(n,t={}){var i;let o=Ie(n),a=Object.assign(Object.assign({},this._requestOptions),t);return Ne(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},o),a)}startChat(n){var t;return new le(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){let i=nt(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),t);return rt(this.apiKey,this.model,i,o)}async embedContent(n,t={}){let i=it(n),o=Object.assign(Object.assign({},this._requestOptions),t);return st(this.apiKey,this.model,i,o)}async batchEmbedContents(n,t={}){let i=Object.assign(Object.assign({},this._requestOptions),t);return lt(this.apiKey,this.model,n,i)}};var ne=class{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new b("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new te(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,i){if(!n.name)throw new w("Cached content must contain a `name` field.");if(!n.model)throw new w("Cached content must contain a `model` field.");let o=["model","systemInstruction"];for(let r of o)if(t?.[r]&&n[r]&&t?.[r]!==n[r]){if(r==="model"){let d=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,p=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(d===p)continue}throw new w(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${n[r]})`)}let a=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new te(this.apiKey,a,i)}};var ie=class e{API_KEY="AIzaSyDd9L_kxeX6z4YGFblnUd8QSCKww0uMLRQ";genAI;constructor(){this.genAI=new ne(this.API_KEY)}async analyzeMeal(n,t){console.log("GeminiNutritionService: analyzeMeal started",{mealDescription:n,hasImage:!!t});let i=this.genAI.getGenerativeModel({model:"gemini-2.5-flash",generationConfig:{responseMimeType:"application/json",temperature:.3}});try{let o=[],a=t?`Analyze this image of food. ${n?`Additional context: ${n}`:""} Provide detailed nutritional breakdown.`:`Analyze the following meal: "${n}". Provide detailed nutritional breakdown including:
        - Total calories
        - Macronutrients (Protein, Carbohydrates, Fats)
        - Fiber, Sugar
        - Vitamins (A, C, D, B12, B6, E, K)
        - Minerals (Calcium, Iron, Potassium, Sodium, Magnesium, Zinc)
        
        For each nutrient, include the amount, unit, and percentage of daily value where applicable.
        
        Return ONLY valid JSON with this structure:
        {
          "calories": number,
          "servingSize": "string",
          "elements": [
            { "name": "string", "amount": number, "unit": "string", "dailyValue": number }
          ]
        }`;if(o.push(a),t){let u=t.replace(/^data:image\/\w+;base64,/,"");o.push({inlineData:{data:u,mimeType:"image/jpeg"}})}let r,d=new Promise((u,g)=>{r=setTimeout(()=>{console.warn("GeminiNutritionService: Timeout reached (10s)"),g(new Error("Gemini API request timed out after 10 seconds"))},1e4)});console.log("GeminiNutritionService: Calling generateContent");let p=i.generateContent(o);console.log("GeminiNutritionService: Starting Promise.race");let C;try{C=await Promise.race([p,d]),clearTimeout(r)}catch(u){throw clearTimeout(r),u}console.log("GeminiNutritionService: Promise.race resolved",C);let y;if(!C)throw new Error("No response from Gemini API");if(C.text&&typeof C.text=="string")y=C.text;else if(C.response){let u=C.response;u&&typeof u.text=="function"?y=await u.text():u&&typeof u.text=="string"&&(y=u.text)}if(!y)throw new Error("No response from Gemini API");console.log("GeminiNutritionService: Response text received",y.substring(0,100)+"...");let O=JSON.parse(y);return{calories:O.calories||0,servingSize:O.servingSize,elements:O.elements||[],confidence:1}}catch(o){return console.error("Gemini API Error:",o),console.warn("Using mock data as fallback due to error/timeout"),this.getMockAnalysis(n)}}getMockAnalysis(n){return{calories:480,servingSize:"1 serving (estimated)",elements:[{name:"Protein",amount:35,unit:"g",dailyValue:70},{name:"Carbohydrates",amount:45,unit:"g",dailyValue:15},{name:"Fats",amount:12,unit:"g",dailyValue:18},{name:"Fiber",amount:8,unit:"g",dailyValue:32},{name:"Vitamin C",amount:25,unit:"mg",dailyValue:28},{name:"Calcium",amount:150,unit:"mg",dailyValue:15},{name:"Iron",amount:4,unit:"mg",dailyValue:22},{name:"Potassium",amount:450,unit:"mg",dailyValue:13},{name:"Sodium",amount:650,unit:"mg",dailyValue:28}],confidence:.5}}static \u0275fac=function(t){return new(t||e)};static \u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"})};var k=class e{STORAGE_KEY="NUTRITION_MEALS";dataUpdated=new pe;dataUpdated$=this.dataUpdated.asObservable();constructor(){}saveMealAnalysis(n,t){let i={id:this.generateId(),description:n,date:new Date,timestamp:Date.now(),analysis:t},o=this.getMealHistory();return o.unshift(i),this.saveMeals(o),this.dataUpdated.next(),i}getMealHistory(){if(typeof localStorage>"u")return[];let n=localStorage.getItem(this.STORAGE_KEY);if(!n)return[];try{return JSON.parse(n).map(i=>ge(ue({},i),{date:new Date(i.date)}))}catch(t){return console.error("Error loading meal history:",t),[]}}calculateAverageElements(){let n=this.getMealHistory();if(n.length===0)return[];let t=new Map;n.forEach(o=>{o.analysis.elements.forEach(a=>{t.has(a.name)||t.set(a.name,{total:0,count:0,unit:a.unit,totalDV:0});let r=t.get(a.name);r.total+=a.amount,r.count+=1,a.dailyValue&&(r.totalDV+=a.dailyValue)})});let i=[];return t.forEach((o,a)=>{i.push({name:a,averageAmount:Math.round(o.total/o.count*100)/100,unit:o.unit,totalMeals:o.count,averageDailyValue:o.totalDV>0?Math.round(o.totalDV/o.count*100)/100:void 0})}),i.sort((o,a)=>o.name.localeCompare(a.name))}deleteMeal(n){let i=this.getMealHistory().filter(o=>o.id!==n);this.saveMeals(i),this.dataUpdated.next()}clearAllMeals(){typeof localStorage<"u"&&(localStorage.removeItem(this.STORAGE_KEY),this.dataUpdated.next())}saveMeals(n){typeof localStorage<"u"&&localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}generateId(){return`meal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static \u0275fac=function(t){return new(t||e)};static \u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"})};var dt=(e,n)=>n.name;function mt(e,n){if(e&1&&(m(0,"div",6),s(1),c()),e&2){let t=h();l(),E(" \u26A0\uFE0F ",t.errorMessage," ")}}function ut(e,n){e&1&&(m(0,"div",7),s(1," \u2705 Meal saved successfully! "),c())}function gt(e,n){e&1&&(G(0,"span",11),s(1," Analyzing with AI... "))}function pt(e,n){e&1&&s(0," \u{1F916} Analyze Meal ")}function ft(e,n){if(e&1){let t=z();m(0,"button",10),J("click",function(){I(t);let o=h();return P(o.analyzeMeal())}),x(1,gt,2,0)(2,pt,1,0),c()}if(e&2){let t=h();$("disabled",!t.isFormValid||t.isAnalyzing),l(),v(t.isAnalyzing?1:2)}}function ht(e,n){if(e&1&&(m(0,"div",13)(1,"span",14),s(2,"Serving:"),c(),m(3,"span",15),s(4),c()()),e&2){let t=h(2);l(4),S(t.analysisResult.servingSize)}}function _t(e,n){if(e&1&&(m(0,"div",23),s(1),c()),e&2){let t=h().$implicit;l(),E("",t.dailyValue,"% DV")}}function Ct(e,n){if(e&1&&(m(0,"div",17)(1,"div",21),s(2),c(),m(3,"div",22),s(4),c(),x(5,_t,2,1,"div",23),c()),e&2){let t=n.$implicit;l(2),S(t.name),l(2),H(" ",t.amount," ",t.unit," "),l(),v(t.dailyValue?5:-1)}}function xt(e,n){if(e&1){let t=z();m(0,"div",9)(1,"h4"),s(2,"\u{1F4CA} Nutritional Analysis"),c(),m(3,"div",12)(4,"div",13)(5,"span",14),s(6,"Calories:"),c(),m(7,"span",15),s(8),c()(),x(9,ht,5,1,"div",13),c(),m(10,"div",16),L(11,Ct,6,4,"div",17,dt),c(),m(13,"div",18)(14,"button",19),J("click",function(){I(t);let o=h();return P(o.saveMeal())}),s(15," \u{1F4BE} Save Meal "),c(),m(16,"button",20),J("click",function(){I(t);let o=h();return P(o.resetForm())}),s(17," \u274C Cancel "),c()()()}if(e&2){let t=h();l(8),E("",t.analysisResult.calories," kcal"),l(),v(t.analysisResult.servingSize?9:-1),l(2),F(t.analysisResult.elements)}}var oe=class e{constructor(n,t,i){this.geminiService=n;this.storageService=t;this.cdr=i}mealDescription="";isAnalyzing=!1;analysisResult=null;errorMessage="";showSuccess=!1;async analyzeMeal(){if(console.log("MealLogger: analyzeMeal called"),!this.mealDescription||this.mealDescription.trim().length<5){this.errorMessage="Please enter a meal description (minimum 5 characters)";return}this.isAnalyzing=!0,this.errorMessage="",this.analysisResult=null;try{console.log("MealLogger: Calling service..."),this.analysisResult=await this.geminiService.analyzeMeal(this.mealDescription),console.log("MealLogger: Service returned",this.analysisResult)}catch(n){console.error("MealLogger: Error caught",n),this.errorMessage=n instanceof Error?n.message:"Failed to analyze meal"}finally{console.log("MealLogger: Finally block - setting isAnalyzing to false"),this.isAnalyzing=!1,this.cdr.detectChanges()}}saveMeal(){this.analysisResult&&(this.storageService.saveMealAnalysis(this.mealDescription,this.analysisResult),this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1,this.resetForm()},2e3))}resetForm(){this.mealDescription="",this.analysisResult=null,this.errorMessage=""}get isFormValid(){return this.mealDescription.trim().length>=5}static \u0275fac=function(t){return new(t||e)(D(ie),D(k),D(xe))};static \u0275cmp=A({type:e,selectors:[["app-meal-logger"]],decls:15,vars:7,consts:[[1,"meal-logger-card"],[1,"subtitle"],[1,"input-section"],["for","meal-description"],["id","meal-description","placeholder","E.g., Grilled chicken breast with brown rice and steamed broccoli...","rows","4",3,"ngModelChange","ngModel","disabled"],[1,"char-counter"],[1,"error-message"],[1,"success-message"],[1,"analyze-btn",3,"disabled"],[1,"analysis-results"],[1,"analyze-btn",3,"click","disabled"],[1,"spinner"],[1,"summary-info"],[1,"info-item"],[1,"label"],[1,"value"],[1,"elements-grid"],[1,"element-card"],[1,"action-buttons"],[1,"save-btn",3,"click"],[1,"cancel-btn",3,"click"],[1,"element-name"],[1,"element-amount"],[1,"element-dv"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"h3"),s(2,"\u{1F37D}\uFE0F Log Your Meal"),c(),m(3,"p",1),s(4,"Describe your meal and get instant AI-powered nutritional analysis"),c(),m(5,"div",2)(6,"label",3),s(7,"What did you eat?"),c(),m(8,"textarea",4),Ce("ngModelChange",function(a){return _e(i.mealDescription,a)||(i.mealDescription=a),a}),c(),m(9,"div",5),s(10),c()(),x(11,mt,2,1,"div",6),x(12,ut,2,0,"div",7),x(13,ft,3,2,"button",8),x(14,xt,18,2,"div",9),c()),t&2&&(l(8),he("ngModel",i.mealDescription),$("disabled",i.isAnalyzing),l(2),E(" ",i.mealDescription.length," characters (min. 5) "),l(),v(i.errorMessage?11:-1),l(),v(i.showSuccess?12:-1),l(),v(i.analysisResult?-1:13),l(),v(i.analysisResult&&!i.showSuccess?14:-1))},dependencies:[N,ye,be,Ee,Me],styles:[".meal-logger-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a2e2a,#0d1b18);border:2px solid #2d4a42;border-radius:16px;padding:30px;max-width:800px;margin:0 auto 30px}.meal-logger-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#fff;margin:0 0 8px}.subtitle[_ngcontent-%COMP%]{color:#a0b9b4;font-size:14px;margin:0 0 25px}.input-section[_ngcontent-%COMP%]{margin-bottom:20px}.input-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#a0b9b4;font-size:14px;font-weight:600;margin-bottom:8px}.input-section[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;background:#2d4a424d;border:2px solid #2d4a42;border-radius:12px;padding:15px;color:#fff;font-size:15px;font-family:inherit;resize:vertical;transition:all .3s ease}.input-section[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50;background:#2d4a4280}.input-section[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.char-counter[_ngcontent-%COMP%]{text-align:right;font-size:12px;color:#7a9590;margin-top:5px}.error-message[_ngcontent-%COMP%]{background:#e74c3c1a;border-left:4px solid #e74c3c;padding:12px 15px;border-radius:8px;color:#fcc;margin-bottom:15px;font-size:14px}.success-message[_ngcontent-%COMP%]{background:#4caf501a;border-left:4px solid #4caf50;padding:12px 15px;border-radius:8px;color:#b8f5b8;margin-bottom:15px;font-size:14px;animation:_ngcontent-%COMP%_slide-in .3s ease}@keyframes _ngcontent-%COMP%_slide-in{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.analyze-btn[_ngcontent-%COMP%], .save-btn[_ngcontent-%COMP%], .cancel-btn[_ngcontent-%COMP%]{padding:14px 28px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;display:inline-flex;align-items:center;gap:8px}.analyze-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;width:100%;justify-content:center}.analyze-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px #4caf504d}.analyze-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.analysis-results[_ngcontent-%COMP%]{margin-top:25px;animation:_ngcontent-%COMP%_fade-in .4s ease}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}.analysis-results[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#4caf50;font-size:20px;margin:0 0 20px}.summary-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}.info-item[_ngcontent-%COMP%]{background:#4caf501a;border:1px solid rgba(76,175,80,.2);border-radius:10px;padding:15px}.info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;color:#a0b9b4;font-size:13px;margin-bottom:5px}.info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:block;color:#4caf50;font-size:20px;font-weight:700}.elements-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;margin-bottom:20px}.element-card[_ngcontent-%COMP%]{background:#2d4a424d;border:1px solid #2d4a42;border-radius:10px;padding:15px;text-align:center;transition:all .3s ease}.element-card[_ngcontent-%COMP%]:hover{border-color:#4caf50;transform:translateY(-2px)}.element-name[_ngcontent-%COMP%]{color:#a0b9b4;font-size:12px;font-weight:600;margin-bottom:8px;text-transform:uppercase}.element-amount[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700;margin-bottom:5px}.element-dv[_ngcontent-%COMP%]{color:#4caf50;font-size:13px;font-weight:600}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px}.save-btn[_ngcontent-%COMP%]{flex:1;background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;justify-content:center}.save-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #4caf504d}.cancel-btn[_ngcontent-%COMP%]{flex:.4;background:#e74c3c1a;border:1px solid rgba(231,76,60,.3);color:#f99;justify-content:center}.cancel-btn[_ngcontent-%COMP%]:hover{background:#e74c3c33;border-color:#e74c3c}@media (max-width: 768px){.meal-logger-card[_ngcontent-%COMP%]{padding:20px}.elements-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}.cancel-btn[_ngcontent-%COMP%]{flex:1}}"]})};var vt=(e,n)=>n.name;function bt(e,n){if(e&1&&s(0),e&2){let t=h();H(" Average nutritional intake across ",t.totalMeals," meal",t.totalMeals>1?"s":""," ")}}function Et(e,n){e&1&&s(0," Your nutritional averages will appear here ")}function Mt(e,n){e&1&&(m(0,"div",2)(1,"div",4),s(2,"\u{1F37D}\uFE0F"),c(),m(3,"h3"),s(4,"No Meals Logged Yet"),c(),m(5,"p"),s(6,"Start logging your meals to see your nutritional intake averages!"),c(),m(7,"p",5),s(8,"AI will analyze each meal and track your nutrients automatically."),c()())}function yt(e,n){if(e&1&&(m(0,"div",12)(1,"div",13)(2,"span"),s(3),c(),m(4,"span",14),s(5),c()(),m(6,"div",15),G(7,"div",16),c()()),e&2){let t=h().$implicit,i=h(2);l(3),E("",t.averageDailyValue,"% Daily Value"),l(),$("ngClass",i.getProgressClass(t.averageDailyValue)),l(),E(" ",i.getStatusText(t.averageDailyValue)," "),l(2),fe("width",i.getProgressWidth(t.averageDailyValue)),$("ngClass",i.getProgressClass(t.averageDailyValue))}}function Ot(e,n){if(e&1&&(m(0,"div",6)(1,"div",7)(2,"h4"),s(3),c(),m(4,"span",8),s(5),c()(),m(6,"div",9)(7,"span",10),s(8),c(),m(9,"span",11),s(10),c()(),x(11,yt,8,6,"div",12),c()),e&2){let t=n.$implicit;l(3),S(t.name),l(2),H("",t.totalMeals," meal",t.totalMeals>1?"s":""),l(3),S(t.averageAmount),l(2),S(t.unit),l(),v(t.averageDailyValue?11:-1)}}function St(e,n){if(e&1&&(m(0,"div",3),L(1,Ot,12,6,"div",6,vt),c()),e&2){let t=h();l(),F(t.elements)}}var ae=class e{constructor(n){this.storageService=n}elements=[];totalMeals=0;showNoDataMessage=!1;dataSubscription;ngOnInit(){this.loadAverages(),this.dataSubscription=this.storageService.dataUpdated$.subscribe(()=>{this.loadAverages()})}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}loadAverages(){let n=this.storageService.getMealHistory();if(this.totalMeals=n.length,n.length===0){this.showNoDataMessage=!0,this.elements=[];return}this.showNoDataMessage=!1,this.elements=this.storageService.calculateAverageElements()}getProgressWidth(n){return n?`${Math.min(n,100)}%`:"0%"}getProgressClass(n){return n?n>=100?"progress-excellent":n>=75?"progress-good":n>=50?"progress-moderate":"progress-low":"progress-unknown"}getStatusText(n){return n?n>=100?"Excellent":n>=75?"Good":n>=50?"Moderate":"Low":"N/A"}static \u0275fac=function(t){return new(t||e)(D(k))};static \u0275cmp=A({type:e,selectors:[["app-elements-dashboard"]],decls:8,vars:2,consts:[[1,"dashboard-container"],[1,"subtitle"],[1,"no-data-message"],[1,"elements-grid"],[1,"message-icon"],[1,"sub-text"],[1,"element-card"],[1,"element-header"],[1,"meal-count"],[1,"element-amount"],[1,"value"],[1,"unit"],[1,"daily-value"],[1,"dv-label"],[1,"status",3,"ngClass"],[1,"progress-bar"],[1,"progress-fill",3,"ngClass"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"h2"),s(2,"\u{1F4CA} Elements Dashboard"),c(),m(3,"p",1),x(4,bt,1,2)(5,Et,1,0),c(),x(6,Mt,9,0,"div",2)(7,St,3,0,"div",3),c()),t&2&&(l(4),v(i.totalMeals>0?4:5),l(2),v(i.showNoDataMessage?6:7))},dependencies:[N,ve],styles:[".dashboard-container[_ngcontent-%COMP%]{background-color:#0d1b18;padding:40px;min-height:100vh}.dashboard-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:32px;font-weight:700;margin-bottom:10px;color:#fff;text-align:center}.subtitle[_ngcontent-%COMP%]{text-align:center;color:#a0b9b4;font-size:16px;margin-bottom:40px}.no-data-message[_ngcontent-%COMP%]{max-width:600px;margin:80px auto;padding:60px 40px;background:linear-gradient(135deg,#1a2e2a,#0d1b18);border:2px solid #2d4a42;border-radius:20px;text-align:center}.message-icon[_ngcontent-%COMP%]{font-size:80px;margin-bottom:20px}.no-data-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:28px;color:#4caf50;margin-bottom:15px;font-weight:700}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#a0b9b4;margin-bottom:10px;line-height:1.6}.sub-text[_ngcontent-%COMP%]{font-size:14px;color:#7a9590;font-style:italic}.elements-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;max-width:1400px;margin:0 auto}.element-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a2e2a,#0d1b18);border:2px solid #2d4a42;border-radius:16px;padding:25px;transition:all .3s ease}.element-card[_ngcontent-%COMP%]:hover{border-color:#4caf50;transform:translateY(-5px);box-shadow:0 10px 30px #4caf5026}.element-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:12px;border-bottom:2px solid #2d4a42}.element-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff;margin:0}.meal-count[_ngcontent-%COMP%]{font-size:12px;color:#7a9590;background:#4caf501a;padding:4px 10px;border-radius:12px}.element-amount[_ngcontent-%COMP%]{margin:20px 0;text-align:center}.element-amount[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:36px;font-weight:700;color:#4caf50}.element-amount[_ngcontent-%COMP%]   .unit[_ngcontent-%COMP%]{font-size:18px;color:#a0b9b4;margin-left:5px}.daily-value[_ngcontent-%COMP%]{margin-top:20px}.dv-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:13px}.dv-label[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:first-child{color:#a0b9b4}.status[_ngcontent-%COMP%]{font-weight:600;padding:3px 10px;border-radius:8px;font-size:12px}.status.progress-excellent[_ngcontent-%COMP%]{background:#2e7d3233;color:#66bb6a}.status.progress-good[_ngcontent-%COMP%]{background:#4caf5033;color:#81c784}.status.progress-moderate[_ngcontent-%COMP%]{background:#ff980033;color:#ffb74d}.status.progress-low[_ngcontent-%COMP%]{background:#f4433633;color:#ef5350}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background:#4caf501a;border-radius:10px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;border-radius:10px;transition:width .5s ease}.progress-fill.progress-excellent[_ngcontent-%COMP%]{background:linear-gradient(90deg,#66bb6a,#4caf50)}.progress-fill.progress-good[_ngcontent-%COMP%]{background:linear-gradient(90deg,#81c784,#66bb6a)}.progress-fill.progress-moderate[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ffb74d,#ff9800)}.progress-fill.progress-low[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ef5350,#f44336)}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:20px}.dashboard-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px}.elements-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.no-data-message[_ngcontent-%COMP%]{padding:40px 20px}}"]})};var wt=(e,n)=>n.id,It=(e,n)=>n.name;function Pt(e,n){if(e&1){let t=z();_(0,"button",5),W("click",function(){I(t);let o=h();return P(o.clearAllMeals())}),s(1," \u{1F5D1}\uFE0F Clear All "),f()}}function Dt(e,n){e&1&&(_(0,"div",3)(1,"div",6),s(2,"\u{1F37D}\uFE0F"),f(),_(3,"h3"),s(4,"No Meals Logged"),f(),_(5,"p"),s(6,"Your meal history will appear here after you analyze and save meals."),f()())}function At(e,n){if(e&1&&(_(0,"div",19)(1,"strong"),s(2,"Serving:"),f(),s(3),f()),e&2){let t=h(2).$implicit;l(3),E(" ",t.analysis.servingSize," ")}}function Nt(e,n){if(e&1&&(_(0,"span",27),s(1),f()),e&2){let t=h().$implicit;l(),E("(",t.dailyValue,"% DV)")}}function Tt(e,n){if(e&1&&(_(0,"div",22)(1,"span",25),s(2),f(),_(3,"span",26),s(4),x(5,Nt,2,1,"span",27),f()()),e&2){let t=n.$implicit;l(2),S(t.name),l(2),H(" ",t.amount," ",t.unit," "),l(),v(t.dailyValue?5:-1)}}function Rt(e,n){if(e&1){let t=z();_(0,"div",18),x(1,At,4,1,"div",19),_(2,"div",20)(3,"h5"),s(4,"Nutritional Elements:"),f(),_(5,"div",21),L(6,Tt,6,4,"div",22,It),f()(),_(8,"div",23)(9,"button",24),W("click",function(o){I(t);let a=h().$implicit;return h(2).deleteMeal(a.id),P(o.stopPropagation())}),s(10," \u{1F5D1}\uFE0F Delete "),f()()()}if(e&2){let t=h().$implicit;l(),v(t.analysis.servingSize?1:-1),l(5),F(t.analysis.elements)}}function kt(e,n){if(e&1){let t=z();_(0,"div",7)(1,"div",8),W("click",function(){let o=I(t).$implicit,a=h(2);return P(a.toggleDetails(o.id))}),_(2,"div",9)(3,"div",10)(4,"span",11),s(5),f(),_(6,"span",12),s(7),f()(),_(8,"h4",13),s(9),f(),_(10,"div",14)(11,"span",15),s(12),f(),_(13,"span",16),s(14),f()()(),_(15,"div",17),s(16),f()(),x(17,Rt,11,1,"div",18),f()}if(e&2){let t=n.$implicit,i=h(2);l(5),E("\u{1F4C5} ",i.formatDate(t.date)),l(2),E("\u{1F550} ",i.formatTime(t.date)),l(2),S(t.description),l(3),E("\u{1F525} ",t.analysis.calories," kcal"),l(2),E(" \u{1F4CA} ",t.analysis.elements.length," nutrients "),l(2),E(" ",i.expandedMealId===t.id?"\u25BC":"\u25B6"," "),l(),v(i.expandedMealId===t.id?17:-1)}}function Lt(e,n){if(e&1&&(_(0,"div",4),L(1,kt,18,7,"div",7,wt),f()),e&2){let t=h();l(),F(t.meals)}}var re=class e{constructor(n){this.storageService=n}meals=[];expandedMealId=null;dataSubscription;ngOnInit(){this.loadMeals(),this.dataSubscription=this.storageService.dataUpdated$.subscribe(()=>{this.loadMeals()})}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}loadMeals(){this.meals=this.storageService.getMealHistory()}toggleDetails(n){this.expandedMealId=this.expandedMealId===n?null:n}deleteMeal(n){confirm("Are you sure you want to delete this meal?")&&this.storageService.deleteMeal(n)}clearAllMeals(){confirm("Are you sure you want to clear all meal history? This cannot be undone.")&&this.storageService.clearAllMeals()}formatDate(n){let t=new Date(n),i=new Date,o=new Date(i);return o.setDate(o.getDate()-1),t.toDateString()===i.toDateString()?"Today":t.toDateString()===o.toDateString()?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}formatTime(n){return new Date(n).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||e)(D(k))};static \u0275cmp=A({type:e,selectors:[["app-meal-history"]],decls:7,vars:2,consts:[[1,"meal-history-container"],[1,"history-header"],[1,"clear-btn"],[1,"no-meals-message"],[1,"meals-list"],[1,"clear-btn",3,"click"],[1,"message-icon"],[1,"meal-card"],[1,"meal-header",3,"click"],[1,"meal-info"],[1,"meal-date-time"],[1,"date"],[1,"time"],[1,"meal-description"],[1,"meal-summary"],[1,"calories"],[1,"elements-count"],[1,"expand-icon"],[1,"meal-details"],[1,"serving-info"],[1,"elements-breakdown"],[1,"elements-grid-small"],[1,"element-item"],[1,"meal-actions"],[1,"delete-btn",3,"click"],[1,"element-name"],[1,"element-value"],[1,"dv"]],template:function(t,i){t&1&&(_(0,"div",0)(1,"div",1)(2,"h2"),s(3,"\u{1F4DC} Meal History"),f(),x(4,Pt,2,0,"button",2),f(),x(5,Dt,7,0,"div",3)(6,Lt,3,0,"div",4),f()),t&2&&(l(4),v(i.meals.length>0?4:-1),l(),v(i.meals.length===0?5:6))},dependencies:[N],styles:[".meal-history-container[_ngcontent-%COMP%]{background-color:#0d1b18;padding:40px;min-height:50vh}.history-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.history-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#fff;margin:0}.clear-btn[_ngcontent-%COMP%]{padding:10px 20px;background:#e74c3c1a;border:1px solid rgba(231,76,60,.3);border-radius:10px;color:#f99;font-size:14px;font-weight:600;cursor:pointer;transition:all .3s ease}.clear-btn[_ngcontent-%COMP%]:hover{background:#e74c3c33;border-color:#e74c3c}.no-meals-message[_ngcontent-%COMP%]{max-width:500px;margin:60px auto;padding:50px 30px;background:linear-gradient(135deg,#1a2e2a,#0d1b18);border:2px solid #2d4a42;border-radius:16px;text-align:center}.message-icon[_ngcontent-%COMP%]{font-size:60px;margin-bottom:15px}.no-meals-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;color:#4caf50;margin-bottom:10px}.no-meals-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#a0b9b4;font-size:14px;line-height:1.6}.meals-list[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;display:flex;flex-direction:column;gap:15px}.meal-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a2e2a,#0d1b18);border:2px solid #2d4a42;border-radius:16px;overflow:hidden;transition:all .3s ease}.meal-card[_ngcontent-%COMP%]:hover{border-color:#4caf50}.meal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 25px;cursor:pointer;-webkit-user-select:none;user-select:none}.meal-info[_ngcontent-%COMP%]{flex:1}.meal-date-time[_ngcontent-%COMP%]{display:flex;gap:15px;margin-bottom:8px}.date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{font-size:13px;color:#7a9590}.meal-description[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#fff;margin:0 0 12px}.meal-summary[_ngcontent-%COMP%]{display:flex;gap:20px;font-size:14px}.calories[_ngcontent-%COMP%]{color:#ff9800;font-weight:600}.elements-count[_ngcontent-%COMP%]{color:#4caf50;font-weight:600}.expand-icon[_ngcontent-%COMP%]{color:#4caf50;font-size:18px;transition:transform .3s ease}.meal-details[_ngcontent-%COMP%]{padding:0 25px 20px;border-top:1px solid #2d4a42;animation:_ngcontent-%COMP%_slideDown .3s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;max-height:0}to{opacity:1;max-height:1000px}}.serving-info[_ngcontent-%COMP%]{margin:15px 0;padding:10px 15px;background:#4caf500d;border-left:3px solid #4caf50;border-radius:6px;font-size:14px;color:#a0b9b4}.serving-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#4caf50}.elements-breakdown[_ngcontent-%COMP%]{margin:20px 0}.elements-breakdown[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#4caf50;font-size:16px;margin-bottom:12px}.elements-grid-small[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.element-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#2d4a424d;border-radius:8px;font-size:13px}.element-name[_ngcontent-%COMP%]{color:#a0b9b4;font-weight:600}.element-value[_ngcontent-%COMP%]{color:#4caf50;font-weight:700}.dv[_ngcontent-%COMP%]{color:#7a9590;font-size:11px;font-weight:400;margin-left:5px}.meal-actions[_ngcontent-%COMP%]{margin-top:15px;display:flex;justify-content:flex-end}.delete-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#e74c3c1a;border:1px solid rgba(231,76,60,.3);border-radius:8px;color:#f99;font-size:13px;font-weight:600;cursor:pointer;transition:all .3s ease}.delete-btn[_ngcontent-%COMP%]:hover{background:#e74c3c33;border-color:#e74c3c}@media (max-width: 768px){.meal-history-container[_ngcontent-%COMP%]{padding:20px}.history-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:15px}.meal-date-time[_ngcontent-%COMP%]{flex-direction:column;gap:5px}.elements-grid-small[_ngcontent-%COMP%]{grid-template-columns:1fr}.meal-summary[_ngcontent-%COMP%]{flex-direction:column;gap:5px}}"]})};var ke=class e{constructor(){}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=A({type:e,selectors:[["app-nutrition"]],decls:10,vars:0,consts:[[1,"nutrition-page-container"],[1,"page-header"],[1,"nutrition-content"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"div",1)(2,"h1"),s(3,"\u{1F957} Nutrition Intelligence"),c(),m(4,"p"),s(5,"AI-powered meal analysis and nutritional insights"),c()(),m(6,"div",2),G(7,"app-meal-logger")(8,"app-elements-dashboard")(9,"app-meal-history"),c()())},dependencies:[N,oe,ae,re],styles:[".nutrition-page-container[_ngcontent-%COMP%]{background-color:#0d1b18;min-height:100vh;padding:20px}.page-header[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;max-width:900px;margin:0 auto 30px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:42px;font-weight:700;color:#fff;margin:0 0 15px;background:linear-gradient(135deg,#4caf50,#81c784);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#a0b9b4;margin:0}.nutrition-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}}"]})};export{ke as NutritionComponent};
